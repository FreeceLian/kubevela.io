(self.webpackChunkkubevela_io=self.webpackChunkkubevela_io||[]).push([[29593],{3905:function(e,n,t){"use strict";t.d(n,{Zo:function(){return u},kt:function(){return d}});var o=t(67294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function a(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?a(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,o,r=function(e,n){if(null==e)return{};var t,o,r={},a=Object.keys(e);for(o=0;o<a.length;o++)t=a[o],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)t=a[o],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var c=o.createContext({}),s=function(e){var n=o.useContext(c),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},u=function(e){var n=s(e.components);return o.createElement(c.Provider,{value:n},e.children)},p={inlineCode:"code",wrapper:function(e){var n=e.children;return o.createElement(o.Fragment,{},n)}},m=o.forwardRef((function(e,n){var t=e.components,r=e.mdxType,a=e.originalType,c=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),m=s(t),d=r,f=m["".concat(c,".").concat(d)]||m[d]||p[d]||a;return t?o.createElement(f,i(i({ref:n},u),{},{components:t})):o.createElement(f,i({ref:n},u))}));function d(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var a=t.length,i=new Array(a);i[0]=m;var l={};for(var c in n)hasOwnProperty.call(n,c)&&(l[c]=n[c]);l.originalType=e,l.mdxType="string"==typeof e?e:r,i[1]=l;for(var s=2;s<a;s++)i[s]=t[s];return o.createElement.apply(null,i)}return o.createElement.apply(null,t)}m.displayName="MDXCreateElement"},80476:function(e,n,t){"use strict";t.r(n),t.d(n,{frontMatter:function(){return i},metadata:function(){return l},toc:function(){return c},default:function(){return u}});var o=t(22122),r=t(19756),a=(t(67294),t(3905)),i={title:"Extend Cloud Resources"},l={unversionedId:"platform-engineers/components/component-terraform",id:"platform-engineers/components/component-terraform",isDocsHomePage:!1,title:"Extend Cloud Resources",description:"To enable end users to provision and consume cloud resources,",source:"@site/docs/platform-engineers/components/component-terraform.md",sourceDirName:"platform-engineers/components",slug:"/platform-engineers/components/component-terraform",permalink:"/docs/next/platform-engineers/components/component-terraform",editUrl:"https://github.com/oam-dev/kubevela.io/edit/main/docs/platform-engineers/components/component-terraform.md",version:"current",lastUpdatedBy:"Avery",lastUpdatedAt:1646881579,formattedLastUpdatedAt:"3/10/2022",frontMatter:{title:"Extend Cloud Resources"},sidebar:"docs",previous:{title:"Extend a Terraform Addon",permalink:"/docs/next/platform-engineers/addon/terraform"},next:{title:"How-to",permalink:"/docs/next/platform-engineers/traits/customize-trait"}},c=[{value:"Develop a Terraform resource or module",id:"develop-a-terraform-resource-or-module",children:[]},{value:"Generate ComponentDefinition",id:"generate-componentdefinition",children:[]},{value:"Apply ComponentDefinition",id:"apply-componentdefinition",children:[]},{value:"Verify",id:"verify",children:[]},{value:"Generate documentation",id:"generate-documentation",children:[]}],s={toc:c};function u(e){var n=e.components,t=(0,r.Z)(e,["components"]);return(0,a.kt)("wrapper",(0,o.Z)({},s,t,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"To enable end users to ",(0,a.kt)("a",{parentName:"p",href:"../../end-user/components/cloud-services/provision-and-consume-cloud-services"},"provision and consume cloud resources"),",\nplatform engineers need to prepare ComponentDefinitions for cloud resources if end users' requirements are beyond the\n",(0,a.kt)("a",{parentName:"p",href:"../../end-user/components/cloud-services/provision-and-consume-cloud-services#supported-cloud-resource-list"},"built-in capabilities"),"."),(0,a.kt)("p",null,"Here is the guide to create Terraform typed ComponentDefinitions of cloud resources for cloud providers Alibaba Cloud, AWS and Azure."),(0,a.kt)("h1",{id:"prerequisites"},"Prerequisites"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"/docs/next/install"},(0,a.kt)("inlineCode",{parentName:"a"},"vela")," binary"))),(0,a.kt)("h2",{id:"develop-a-terraform-resource-or-module"},"Develop a Terraform resource or module"),(0,a.kt)("p",null,"Create a Terraform resource or module for a cloud resource."),(0,a.kt)("p",null,"For example, we created a Terraform resource for AWS S3 bucket, and stored it in a local file named ",(0,a.kt)("inlineCode",{parentName:"p"},"aws_s3_bucket.tf"),"."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-terraform"},'resource "aws_s3_bucket" "bucket-acl" {\n  bucket = var.bucket\n  acl = var.acl\n}\n\noutput "BUCKET_NAME" {\n  value = aws_s3_bucket.bucket-acl.bucket_domain_name\n}\n\nvariable "bucket" {\n  description = "S3 bucket name"\n  default = "vela-website"\n  type = string\n}\n\nvariable "acl" {\n  description = "S3 bucket ACL"\n  default = "private"\n  type = string\n}\n')),(0,a.kt)("p",null,"We also created a Terraform module for Alibaba Cloud EIP, and stored it in GitHub repository ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/oam-dev/terraform-alibaba-eip.git"},"https://github.com/oam-dev/terraform-alibaba-eip.git"),"."),(0,a.kt)("h2",{id:"generate-componentdefinition"},"Generate ComponentDefinition"),(0,a.kt)("p",null,"By running ",(0,a.kt)("inlineCode",{parentName:"p"},"vela def init")," command, we can generate a ComponentDefinition for a cloud resource based on Terraform resource or module\neither from a local file, or from a remote GitHub repository."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"$vela def init -h\n\n      --git string             Specify which git repository the configuration(HCL) is stored in. Valid when --provider/-p is set.\n      --local string           Specify the local path of the configuration(HCL) file. Valid when --provider/-p is set.\n")),(0,a.kt)("p",null,"We use ",(0,a.kt)("inlineCode",{parentName:"p"},"--local")," to accept Terraform resource or module from a local file to generate a ComponentDefinition."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},'$vela def init s3 --type component --provider aws --desc "Terraform configuration for AWS S3" --local aws_s3_bucket.tf\n\napiVersion: core.oam.dev/v1beta1\nkind: ComponentDefinition\nmetadata:\n  annotations:\n    definition.oam.dev/description: Terraform configuration for AWS S3\n  creationTimestamp: null\n  labels:\n    type: terraform\n  name: aws-s3\n  namespace: vela-system\nspec:\n  schematic:\n    terraform:\n      configuration: |\n        resource "aws_s3_bucket" "bucket-acl" {\n          bucket = var.bucket\n          acl = var.acl\n        }\n\n        output "BUCKET_NAME" {\n          value = aws_s3_bucket.bucket-acl.bucket_domain_name\n        }\n\n        variable "bucket" {\n          description = "S3 bucket name"\n          default = "vela-website"\n          type = string\n        }\n\n        variable "acl" {\n          description = "S3 bucket ACL"\n          default = "private"\n          type = string\n        }\n  workload:\n    definition:\n      apiVersion: terraform.core.oam.dev/v1beta1\n      kind: Configuration\nstatus: {}\n')),(0,a.kt)("p",null,"We use ",(0,a.kt)("inlineCode",{parentName:"p"},"--git")," to accept Terraform module or resource from a remote GitHub repository to generate a ComponentDefinition."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},'$ vela def init eip --type component --provider alibaba --desc "Terraform configuration for Alibaba Cloud Elastic IP" --git https://github.com/oam-dev/terraform-alibaba-eip.git\n\napiVersion: core.oam.dev/v1beta1\nkind: ComponentDefinition\nmetadata:\n  annotations:\n    definition.oam.dev/description: Terraform configuration for Alibaba Cloud Elastic\n      IP\n  creationTimestamp: null\n  labels:\n    type: terraform\n  name: alibaba-eip\n  namespace: vela-system\nspec:\n  schematic:\n    terraform:\n      configuration: https://github.com/oam-dev/terraform-alibaba-eip.git\n      type: remote\n  workload:\n    definition:\n      apiVersion: terraform.core.oam.dev/v1beta1\n      kind: Configuration\nstatus: {}\n')),(0,a.kt)("p",null,"You are warmly welcome to contribute this extended cloud resource ComponentDefinition to ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/oam-dev/catalog/tree/master/addons/"},"oam-dev/catalog"),"."),(0,a.kt)("h2",{id:"apply-componentdefinition"},"Apply ComponentDefinition"),(0,a.kt)("p",null,"Write the generated ComponentDefinition into a file named ",(0,a.kt)("inlineCode",{parentName:"p"},"terraform-<ComponentDefinition_NAME>.yaml")," and apply it to the running Kubernetes cluster."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl apply -f <FILENAME>\n")),(0,a.kt)("h2",{id:"verify"},"Verify"),(0,a.kt)("p",null,"You can quickly verify the ComponentDefinition by command ",(0,a.kt)("inlineCode",{parentName:"p"},"vela show"),"."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"$ vela show alibaba-eip\n# Properties\n+----------------------------+------------------------------------------------------------------------------------------+-----------------------------------------------------------+----------+---------+\n|            NAME            |                                       DESCRIPTION                                        |                           TYPE                            | REQUIRED | DEFAULT |\n+----------------------------+------------------------------------------------------------------------------------------+-----------------------------------------------------------+----------+---------+\n| name                       | Name to be used on all resources as prefix. Default to 'TF-Module-EIP'.                  | string                                                    | true     |         |\n| bandwidth                  | Maximum bandwidth to the elastic public network, measured in Mbps (Mega bit per second). | number                                                    | true     |         |\n| writeConnectionSecretToRef | The secret which the cloud resource connection will be written to                        | [writeConnectionSecretToRef](#writeConnectionSecretToRef) | false    |         |\n+----------------------------+------------------------------------------------------------------------------------------+-----------------------------------------------------------+----------+---------+\n\n\n## writeConnectionSecretToRef\n+-----------+-----------------------------------------------------------------------------+--------+----------+---------+\n|   NAME    |                                 DESCRIPTION                                 |  TYPE  | REQUIRED | DEFAULT |\n+-----------+-----------------------------------------------------------------------------+--------+----------+---------+\n| name      | The secret name which the cloud resource connection will be written to      | string | true     |         |\n| namespace | The secret namespace which the cloud resource connection will be written to | string | false    |         |\n+-----------+-----------------------------------------------------------------------------+--------+----------+---------+\n")),(0,a.kt)("p",null,"If the tables display, the ComponentDefinition should work. To take a step further, you can verify it by provision an actual EIP instance per\nthe doc ",(0,a.kt)("a",{parentName:"p",href:"../../end-user/components/cloud-services/provision-and-consume-cloud-services#provision-cloud-resources"},"Provision cloud resources"),"."),(0,a.kt)("h2",{id:"generate-documentation"},"Generate documentation"),(0,a.kt)("p",null,"You are encouraged to generate the documentation for your ComponentDefinition and submit it to ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/oam-dev/kubevela.io"},"KubeVela official site"),"."),(0,a.kt)("p",null,"By running ",(0,a.kt)("inlineCode",{parentName:"p"},"vela def doc-gen")," command, we can generate related docs for the ComponentDefinition either from a local file, or from the running application on kubernetes cluster."),(0,a.kt)("p",null,"If you choose to generate docs from running cluster, you should provide the name of the ComponentDefinition and the namespace which it is running in."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"$ vela def doc-gen alibaba-eip -n vela-system\nGenerated docs for alibaba-eip in ./kubevela.io/docs/end-user/components/cloud-services/terraform/alibaba-eip.md\n")),(0,a.kt)("p",null,"If you choose to generate docs from local ComponentDefinition file, you should provide the file path."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"$ vela def doc-gen alibaba-eip.yaml\n")),(0,a.kt)("p",null,"Move the file generated to ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/oam-dev/kubevela.io"},"oam-dev/kubevela.io")," repo. Follow the ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/oam-dev/kubevela.io#contributing-to-kubevela-en-docs"},"contribution guide")," to submit the doc."))}u.isMDXComponent=!0}}]);